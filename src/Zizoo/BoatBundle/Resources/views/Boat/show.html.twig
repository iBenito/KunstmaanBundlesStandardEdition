{% extends 'ZizooBoatBundle::layout.html.twig' %}
{% trans_default_domain "labels" %}

{% block title %}{{ boat.name }}{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('js/colour_gradient.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/datepick/jquery.datepick.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/datepick/jquery.datepick.ext.js') }}"></script>
{% endblock %}
    
{% block stylesheets %}
    {{ parent() }}
    <!--<link href="{{ asset('css/datepick/jquery.datepick.css') }}" type="text/css" rel="stylesheet" />-->
    <link href="{{ asset('css/datepick/ui-ui-zizoo.css') }}" type="text/css" rel="stylesheet" />
{% endblock %}

{% block body %}
    <div class="row-fluid">
        
        <div id="left-col" class="span2">
            <ul id="boat-tabs">
                <li><a href="#tabs-1">Photos</a></li>
                <li><a href="#tabs-2">Location</a></li>
                <li><a href="#tabs-3">Availability</a></li>
            </ul>
        </div>
        
        <div id="center-col" class="span7">
            
            <div class="tabs">
                <div id="tabs-1" class="tab">
                    <section class="images" id="images">
                        <h3>{% trans %}zizoo_boat.label.images{% endtrans %}</h3>
                        {% include 'ZizooBoatBundle:Image:index.html.twig' with { 'images': boat.image } %}
                    </section>
                </div>

                <div id="tabs-2" class="tab" style="width: 100%;">
                    <h2>Location</h2>
                    {{ google_map_container(map) }}
                </div>

                <div id="tabs-3" class="tab current">
                    <h2>Availability</h2>
                    <div id="calendar" class="">
                    </div>
                </div>
            </div>
            
            <article class="boat">

                <header>
                    <h2>{{ boat.title }}</h2>
                </header>
                <div>
                    <p>{{ boat.description }}</p>
                </div>
            </article>

            <section class="details" id="details">
                <h3>{{ boat.name }}</h3>
                <p>{% trans %}zizoo_address.label.cities{% endtrans %}: 
                    <ul>
                        <li>{{ boat.address.locality }}</li>
                    </ul>
                </p>
                <p>{% trans %}zizoo_boat.label.brand{% endtrans %}: {{ boat.brand }}</p>
                <p>{% trans %}zizoo_boat.label.model{% endtrans %}: {{ boat.model }}</p>
                <p>{% trans %}zizoo_boat.label.length{% endtrans %}: {{ boat.length }}</p>
                <p>{% trans %}zizoo_boat.label.cabins{% endtrans %}: {{ boat.cabins }}</p>
                {% if boat.bathrooms %}
                    <p>{% trans %}zizoo_boat.label.bathrooms{% endtrans %}: {{ boat.bathrooms }}</p>
                {% endif %}

            </section>

        </div>
        
        <div id="right-col" class="span3">
            {% render 'ZizooBoatBundle:Boat:bookingWidget' with {id: boat.id, request:request} %}
        </div>
        
    </div>

    <style type="text/css">
        #center-col {
            margin-left: 0;
        }
        
        .tabs {
            position: relative;
        }
        
        .tabs .tab {
            position: absolute;
            top: -5000px;
            left: 0;
        }
        
        .tabs .tab.current {
            display: block;
            position: static;
            top: 0;
        }
        
        #calendar {
            width: 100%;
            max-width: 100%;
        }
        
        
        #calendar .ui-datepicker-inline {
            width: 100% !important;
        }
        
        #calendar .ui-datepicker-group.last-in-line {
            margin-right: 0;
        }
        
        #calendar .ui-datepicker-group {
            margin-right: 0;
            width: 50%;
        }
        
        #calendar .ui-datepicker-group-last {
            margin-right: 0;
        }
        
        .day_price {
            padding: 0 !important;
            margin: 0 !important;
            text-align: right !important;
        }
        
    </style>
    
    {{ google_map_js(map) }}
    
    <script type="text/javascript">
        var disableCallback = false;
        var reservedDates;
        var priceDates;
        
        function clearDates(){
            $('#calendar').datepick('setDate', []);
        }
        
        function selectDate(dates){
            if (disableCallback) return;
            if (dates.length>1){
                if (dates[0].getDate()==dates[1].getDate() && dates[0].getMonth()==dates[1].getMonth() && dates[0].getFullYear()==dates[1].getFullYear()){
                    $('#zizoo_boat_book_reservation_from').val('');
                    $('#zizoo_boat_book_reservation_to').val('');
                } else {
                    $('#zizoo_boat_book_reservation_from').val(dates[0].getDateFormatted()+'/'+(dates[0].getMonthFormatted())+'/'+dates[0].getFullYear());
                    $('#zizoo_boat_book_reservation_to').val(dates[1].getDateFormatted()+'/'+dates[1].getMonthFormatted()+'/'+dates[1].getFullYear());
                    reloadWidget();
                }
            }
        }
        
        function setupCalendar(){
            
            
            $.extend($.datepick, {
                zizoo_availability: function(date) {
                    var i;
                    for (i=0; i<reservedDates.length; i++){
                        if (date.getFullYear()==reservedDates[i][0] && date.getMonthFormatted()==reservedDates[i][1] && date.getDateFormatted()==reservedDates[i][2])
                        {
                            return {selectable: false, dateClass: 'day_disabled', content: reservedDates[i][2] + '<span class="day_price">B</span>'};                            
                        }
                    }
                    var i;
                    for (i=0; i<priceDates.length; i++){
                        if (date.getFullYear()==priceDates[i][0] && date.getMonthFormatted()==priceDates[i][1] && date.getDateFormatted()==priceDates[i][2])
                        {
                            return {selectable: true, content: priceDates[i][2] + '<span class="day_price">&euro;' + priceDates[i][3] + '</span>'};                            
                        }
                    }
                    return {selectable: false, dateClass: 'day_disabled', content: date.getDateFormatted() + '<span class="day_price">U</span>'};
                }
            });
            
            $('#calendar').datepick({ 
                rangeSelect: true,
                changeMonth: false,
                monthsToShow: [2,2],
                onDate: $.datepick.zizoo_availability,
                onSelect: selectDate,
                renderer: $.datepick.themeRollerRenderer
            });
            if (callbackDates && callbackDates.length==2){
                disableCallback = true;
                $('#calendar').datepick('setDate', callbackDates);
                disableCallback = false;
            }
            
            
            //$('#zizoo_boat_book_reservation_from').datepick('setDate', $('#zizoo_boat_book_reservation_from').val()); 
            //$('#zizoo_boat_book_reservation_to').datepick('setDate', $('#zizoo_boat_book_reservation_to').val()); 
        }
        
        $(document).ready(function(){
            setupCalendar();
            
            $( "#boat-tabs a" ).click(function(){
                var tabId = $(this).attr('href');
                $('.tabs .tab').removeClass('current');
                $('.tabs '+tabId).addClass('current');
                return false;
            });
            
            
        });
    </script>

{% endblock %}