{# src/Zizoo/AddressBundle/Resources/views/Address/locations_test.html.twig #}
{% trans_default_domain "labels" %}

{% extends 'ZizooAddressBundle::layout.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/tags/markermanager/1.0/src/markermanager.js"></script>
    <script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer_compiled.js"></script>
    <script type="text/javascript" src="{{ asset('js/jquery.blockUI.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/chosen.jquery.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/zizooaddress/js/locations.js') }}"></script>
{% endblock %}


{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/chosen.css') }}" type="text/css" rel="stylesheet" />
    <link href="{{ asset('bundles/zizooaddress/css/locations.css') }}" type="text/css" rel="stylesheet" />
{% endblock %}


{% block search_results %}

    <div id="all">
        <div class="tabbed">
            {% include "ZizooAddressBundle:Address:boats_grid.html.twig" with {'page': page, 'page_size': page_size } %}
            {% include "ZizooAddressBundle:Address:boats_list.html.twig" with {'page': page, 'page_size': page_size } %}
        </div>
    </div>
    
{% endblock search_results %}
    
{% block search_filter %}
    <form class="form">
        <div class="box">
            <h3>Boat Type</h3>
            <div class="block">
                <div class="row">
                    <label><input type="checkbox"> Yacht</label>
                </div>
                <div class="row">
                    <label><input type="checkbox"> Sail Boat</label>
                </div>
                <div class="row">
                    <label><input type="checkbox" checked="checked"> Motor Boat</label>
                </div>
                <div class="row">
                    <label><input type="checkbox"> Catamaran</label>
                </div>
            </div>
        </div>
    </form>









    <div id="search-filter" style="display: none">
        <div id="boat_type_filter">
        {{ form_row(form.filter.boat_type) }}
        </div>
        <div id="length_filter">
            <label for="length_text">Boat Length:</label>
            <div id="length_text">1 - {{ max_length }}</div>
            <div id="length_slider"></div>
        </div>
        <div id="price_filter">
            <label for="price_text">Price:</label>
            <div id="price_text">1 - {{ max_price }}</div>
            <div id="price_slider"></div>
        </div>
        <div id="num_cabins_filter">
            <label for="num_cabins_text">Number of cabins:</label>
            <div id="num_cabins_text">1 - {{ max_cabins }}</div>
            <div id="num_cabins_slider"></div>
        </div>
        <div id="equipment_filter">
            {{ form_row(form.filter.equipment) }}
        </div>
        {{ form_widget(form.filter.length_from) }}
        {{ form_widget(form.filter.length_from) }}
        {{ form_widget(form.filter.length_to) }}
        {{ form_widget(form.filter.num_cabins_from) }}
        {{ form_widget(form.filter.num_cabins_to) }}
        {{ form_widget(form.filter.price_from) }}
        {{ form_widget(form.filter.price_to) }}
    </div>
    
    <script type="text/javascript">
        
        function doBlock(block){
            if (block){
                $('#map').block({ message: null }); 
                $('#boats').block({ message: null }); 
                $('#search-filter').block({ message: null });
            } else {
                $('#map').unblock();
                $('#boats').unblock();
                $('#search-filter').unblock();
            }
        }

        function updateSearch(page){
            doBlock(true);
            $('#search_form #zizoo_boat_search_page').val(page);

            var index   = $('#zizoo_boat_search_location :selected').index();
            var type    = null;
            var val     = null;
            var search  = null;

            if (index>0){
                type = $('#zizoo_boat_search_location option:nth-of-type('+(index+1)+')').attr('class');
                search = $('#zizoo_boat_search_location option:nth-of-type('+(index+1)+')').attr('search');
                val  = $('#zizoo_boat_search_location').val();
            }

            $.ajax({
                type: 'get', 
                url: $('#search_form').attr('search_form'),
                data:$('#search_form').serialize(),
                success: function(data, textStatus, XHR){
                    $('#boats').html(data);
                    if(val==null){
                        map.setCenter(center);
                        map.setZoom(zoom);
                    } else {
                        codeAddress(search);
                        map.setZoom(5);
                    }
                    doBlock(false);
                }
            });

        }

        $(document).ready(function(){

            $( "#length_slider" ).slider({
                range: true,
                min: 1,
                max: {{ max_length }},
                values: [ 1, {{ max_length }} ],
                slide: function( event, ui ) {
                    $( "#zizoo_boat_search_filter_length_from" ).val(ui.values[ 0 ]);
                    $( "#zizoo_boat_search_filter_length_to" ).val(ui.values[ 1 ]);
                    $( "#length_text" ).html(ui.values[ 0 ] + " - " + ui.values[ 1 ] );
                },
                stop: function( event, ui ){
                    updateSearch(1);
                }
            });

            $( "#num_cabins_slider" ).slider({
                range: true,
                min: 1,
                max: {{ max_cabins }},
                values: [ 1, {{ max_cabins }} ],
                slide: function( event, ui ) {
                    $( "#zizoo_boat_search_filter_num_cabins_from" ).val(ui.values[ 0 ]);
                    $( "#zizoo_boat_search_filter_num_cabins_to" ).val(ui.values[ 1 ]);
                    $( "#num_cabins_text" ).html(ui.values[ 0 ] + " - " + ui.values[ 1 ] );
                },
                stop: function( event, ui ){
                    updateSearch(1);
                }
            });

            $( "#price_slider" ).slider({
                range: true,
                min: 1,
                max: {{ max_price }},
                values: [ 1, {{ max_price }} ],
                slide: function( event, ui ) {
                    $( "#zizoo_boat_search_filter_price_from" ).val(ui.values[ 0 ]);
                    $( "#zizoo_boat_search_filter_price_to" ).val(ui.values[ 1 ]);
                    $( "#price_text" ).html(ui.values[ 0 ] + " - " + ui.values[ 1 ] );
                },
                stop: function( event, ui ){
                    updateSearch(1);
                }
            });


            $('#boat_type_filter input[type="checkbox"]').change(function(){
                updateSearch(1);
            });

            $('#equipment_filter input[type="checkbox"]').change(function(){
                updateSearch(1);
            });

            $( "#zizoo_boat_search_reservation_from" ).attr('placeholder', 'From');
            $( "#zizoo_boat_search_reservation_to" ).attr('placeholder', 'Until');
            $( "#zizoo_boat_search_num_guests" ).attr('placeholder', 'Number of people');

            $('#search-filter').show();
        });

    </script>
    
{% endblock search_filter %}
    
    
{% block search_map %}
    <div id="map"></div>
    <div id="map_div">
    </div>
{% endblock search_map %}
    
