<div>
    
    <!-- start:view -->
    <div id="view" class="clearfix">
        {{ pagination.setTemplate('ZizooBaseBundle:Elements:pagination_sliding_search.html.twig') }}
        {{ knp_pagination_render(pagination) }}
    </div>
    <!-- end:view -->
                
    <div class="tabbed">
    {% include "ZizooAddressBundle:Address:boats_grid.html.twig" with {'pagination': pagination } %}
    {% include "ZizooAddressBundle:Address:boats_list.html.twig" with {'pagination': pagination } %}
    </div>
    <div id="results-navigation">
    {{ pagination.setTemplate('ZizooBaseBundle:Elements:pagination_sliding.html.twig') }}
    {{ knp_pagination_render(pagination) }}
    </div>
    
    <style type="text/css">
        #all .box .boat {
            position: relative;
        }
        #all .box .boat.disabled .tooltip.disabled {
            right: 5px;
            bottom: 5px;
        }
        #all .box .boat.disabled:hover .tooltip.disabled {
            visibility: visible;
            opacity: 1;
        }
    </style>
    
    <script type="text/javascript">
        
        function setupUnavailableTooltips(){
            $("#all .box .boat.disabled").each(function() {
                var resFrom     = $('#zizoo_boat_search_reservation_from').val();
                var resTo       = $('#zizoo_boat_search_reservation_to').val();
                var msg = null;
                if (resFrom!='' || resTo!=''){
                    msg = 'This boat is not available for ';
                    msg += 'dates ';
                    if (resFrom!='' && resTo!='') {
                        msg += resFrom + '&ndash;' + resTo;
                    } else if (resFrom!=''){
                        msg += 'from ' + resFrom;
                    } else {
                        msg += 'until ' + resTo;
                    }
                    msg += '.';
                } else {
                    msg = 'This boat is not available.';
                }
                $(this).append('<span class="tooltip disabled"><strong>'+msg+'</strong></span>');
            });
        }
        
        $(document).ready(function(){

            setupUnavailableTooltips();

            markers = new Array();
            infoWindows = new Array();
            lastOpenWindow = -1;
            {% set index = 0 %}
            mc.clearMarkers();
            {% for boat in boats %}
                {% if boat|bookable(form.vars.value.reservationFrom, form.vars.value.reservationTo)==true%}

                    {% if boat.address.lat is not null and boat.address.lng is not null %}

                        infoWindows.push(new google.maps.InfoWindow({
                            content: {% include "ZizooAddressBundle:Address:locations_boat_info_window.html.twig" with {'boat': boat } %}
                        }));
                        markers.push(new google.maps.Marker({
                            title: '{{ boat.name }}',
                            position: new google.maps.LatLng(
                                 {{ boat.address.lat }}, {{ boat.address.lng }}),
                            clickable: true,
                            draggable: false,
                            flat: true,
                            icon: new google.maps.MarkerImage('{{ asset('/bundles/zizoobase/images/google-maps-marker.png') }}', null, null, null, null)
                        }));
                        google.maps.event.addListener(markers[{{ index }}], 'click', function() {
                            if (lastOpenWindow!=-1){
                                infoWindows[lastOpenWindow].close();
                            }
                            infoWindows[{{ index }}].open(map, markers[{{ index }}]);
                            lastOpenWindow = {{ index }};
                          });
                          {% set index = index + 1 %}
                    {% endif %}
                {% endif %}
            {% endfor %}
            mc = new MarkerClusterer(map, markers, {maxZoom: 19});

        });
    </script>
    
</div>