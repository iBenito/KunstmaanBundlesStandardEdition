{% trans_default_domain "labels" %}
{% for boat in boats %}
    {% if loop.index0 % page_size == 0 %}
    <div class="page{% if (loop.index0 / page_size)+1 == page %} current {% endif %}" id="page_{{ (loop.index0 / page_size)+1 }}">
    {% endif %}
        <article class="boat{% if boat|reservationExists(res_from, res_to)==true %} booked{% endif %}">
            <header>
                <h2>{{ boat.title }}</h2>
            </header>
            <div>
                <p>{{ boat.description }}</p>
            </div>


            <section class="details" id="details">
                <h3>{{ boat.name }}</h3>
                <p>{% trans %}zizoo_address.label.cities{% endtrans %}: 
                    <ul>
                        {% for address in boat.addresses %}
                            <li>{{ address.locality }}</li>
                        {% endfor %}
                    </ul>
                </p>
                <p>{% trans %}zizoo_boat.label.brand{% endtrans %}: {{ boat.brand }}</p>
                <p>{% trans %}zizoo_boat.label.model{% endtrans %}: {{ boat.model }}</p>
                <p>{% trans %}zizoo_boat.label.length{% endtrans %}: {{ boat.length }}</p>
                <p>{% trans %}zizoo_boat.label.cabins{% endtrans %}: {{ boat.cabins }}</p>
                {% if boat.bathrooms %}
                    <p>{% trans %}zizoo_boat.label.bathrooms{% endtrans %}: {{ boat.bathrooms }}</p>
                {% endif %}

            </section>

            <section class="images" id="images">
                <h3>{% trans %}zizoo_boat.label.images{% endtrans %}</h3>
                {% for image in boat.image %}
                    <article class="image" id="image-{{ image.id }}">
                        <img src="{{ asset(image|imageWebPath)| imagine_filter('thumb_75x75') }}" alt="{{ image.path }} image not found" class="large" />
                    </article>
                {% else %}
                    <p>There are no images for this boat.</p>
                {% endfor %}
            </section>
        </article>
    {% if loop.index % page_size == 0 or loop.last %}
    </div>
    {% endif %}
{% endfor %}
<div class="paging_div">
    {% if num_pages > 1 %}
        <ul id="paging">
        {% for i in range(1, num_pages) %}
            <li class="{{ i }}"><a href="{{ path('zizoo_address_locations') }}?page={{ i }}&search={{ current }}&reservation_from={{ res_from }}&reservation_to={{ res_to }}&num_guests={{ num_guests }}">Page {{ i }}</a></li>
        {% endfor %}
        </ul>
    {% endif %}
</div>
<script type="text/javascript">
    $(document).ready(function(){
        
        markers = new Array();
        infoWindows = new Array();
        lastOpenWindow = -1;
        {% set index = 0 %}
        mc.clearMarkers();
        {% for boat in boats %}
            {% if boat|reservationExists(res_from, res_to)!=true %}
                {% for address in boat.addresses %}
                    infoWindows.push(new google.maps.InfoWindow({
                        content: {% include "ZizooAddressBundle:Address:locations_boat_info_window.html.twig" with {'boat': boat } %}
                    }));
                    markers.push(new google.maps.Marker({
                        title: '{{ boat.name }}',
                        position: new google.maps.LatLng(
                             {{ address.lat }}, {{ address.lng }}),
                             clickable: true,
                             draggable: false,
                             flat: true
                    }));
                    google.maps.event.addListener(markers[{{ index }}], 'click', function() {
                        if (lastOpenWindow!=-1){
                            infoWindows[lastOpenWindow].close();
                        }
                        infoWindows[{{ index }}].open(map, markers[{{ index }}]);
                        lastOpenWindow = {{ index }};
                      });
                      {% set index = index + 1 %}
                {% endfor %}
            {% endif %}
        {% endfor %}
        mc = new MarkerClusterer(map, markers, {maxZoom: 19});
        
        $('#paging li a').click(function(el){
            $('#boats').block({ message: null });
            var page = $(this).parent().attr('class');
            
            $('#boats .page').hide().removeClass('current');
            $('#boats #page_'+page).show().addClass('current');
            $('#boats').unblock();
            return false;
            
            var url = $(this).attr('href');
            url = encodeURI(url);
            $('#boats').load(url, function(){
                $('#boats').unblock();
            });
            return false;
        });
    });
</script>